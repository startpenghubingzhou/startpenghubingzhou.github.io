<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      电池热补丁制作教程 | 望海之洲 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="John Doe">
    
    

    <meta name="description" content="前言这个教程，是基于宪武大神的口述，加上博主的亲身实践并精心整理而成的，且发布已经得到宪武大神的授权，任何其他形式的转载请注明出处！！！教程并不一定适用于所有情况，只是给各位提供一个比较基础的思路。如果中间有任何问题，欢迎反馈给我，好让我及时更新教程。  我为什么要修改修改这个的意义，实际就是热补丁的意义。尽管我已经在我的另一篇教程里面说过了热补丁的好处，我还是乐意在这里再复述一遍。 热补丁的编辑">
<meta name="keywords" content="DSDT,电池">
<meta property="og:type" content="article">
<meta property="og:title" content="电池热补丁制作教程 | 望海之洲">
<meta property="og:url" content="http://yoursite.com/2019/05/02/Battery Hotpatch Make/index.html">
<meta property="og:site_name" content="望海之洲">
<meta property="og:description" content="前言这个教程，是基于宪武大神的口述，加上博主的亲身实践并精心整理而成的，且发布已经得到宪武大神的授权，任何其他形式的转载请注明出处！！！教程并不一定适用于所有情况，只是给各位提供一个比较基础的思路。如果中间有任何问题，欢迎反馈给我，好让我及时更新教程。  我为什么要修改修改这个的意义，实际就是热补丁的意义。尽管我已经在我的另一篇教程里面说过了热补丁的好处，我还是乐意在这里再复述一遍。 热补丁的编辑">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E6%8E%88%E6%9D%83.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E5%A4%8D%E5%88%B6ecf2.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E6%8F%92%E5%85%A5%E6%96%B9%E6%B3%95.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E5%B1%82%E7%BA%A7.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E6%97%A0%E5%B1%82%E7%BA%A7%E9%94%99%E8%AF%AF.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E7%BC%96%E8%AF%911.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/basc.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E7%BC%96%E8%AF%912.png">
<meta property="og:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E6%97%A0%E9%94%99.png">
<meta property="og:updated_time" content="2019-12-24T08:32:04.460Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="电池热补丁制作教程 | 望海之洲">
<meta name="twitter:description" content="前言这个教程，是基于宪武大神的口述，加上博主的亲身实践并精心整理而成的，且发布已经得到宪武大神的授权，任何其他形式的转载请注明出处！！！教程并不一定适用于所有情况，只是给各位提供一个比较基础的思路。如果中间有任何问题，欢迎反馈给我，好让我及时更新教程。  我为什么要修改修改这个的意义，实际就是热补丁的意义。尽管我已经在我的另一篇教程里面说过了热补丁的好处，我还是乐意在这里再复述一遍。 热补丁的编辑">
<meta name="twitter:image" content="http://yoursite.com/2019/05/02/Battery%20Hotpatch%20Make/%E6%8E%88%E6%9D%83.png">
    
    
      <link rel="alternate" href="/atom.xml" title="望海之洲" type="application/atom+xml">
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for 望海之洲"><img src="/avatar.png" width="80" alt="望海之洲 logo" class="panel-cover__logo logo"></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">望海之洲</a></h1>
        <hr class="panel-cover__divider">

        
        <p class="panel-cover__description">
          澎湖冰洲的极客地带
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">总览</a></li>
              
                
                <li class="navigation__item"><a href="/resources" title="" class="">资源</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/penghubingzhou" title="Huno on GitHub">
          <i class="icon icon-social-github"></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">电池热补丁制作教程</h1>

    
    <div class="post-meta">
      <time datetime="2019-05-02" class="post-meta__date date">2019-05-02</time> 
      <span class="post-meta__tags tags">
          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/教程/">教程</a>
            </font>
          
          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/DSDT/">DSDT</a>, <a class="tags-link" href="/tags/电池/">电池</a>
            </font>
          
      </span>

      <span class="post-meta__wordcount wordcount">
      <font class="wordcount">
      &#8227; 文章字数:
      5.7k
      </font> 
      </span>
    
    </div>
    
  </header>


  <section id="post-content" class="article-content post">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这个教程，是基于宪武大神的口述，加上博主的亲身实践并精心整理而成的，且发布已经得到宪武大神的授权，任何其他形式的转载请注明出处！！！教程并不一定适用于所有情况，只是给各位提供一个比较基础的思路。如果中间有任何问题，欢迎反馈给我，好让我及时更新教程。</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E6%8E%88%E6%9D%83.png" alt="授权"></p>
<h1 id="我为什么要修改"><a href="#我为什么要修改" class="headerlink" title="我为什么要修改"></a>我为什么要修改</h1><p>修改这个的意义，实际就是热补丁的意义。尽管我已经在我的另一篇<a href="http://bbs.pcbeta.com/viewthread-1797378-1-1.html" target="_blank" rel="noopener">教程</a>里面说过了热补丁的好处，我还是乐意在这里再复述一遍。</p>
<p><strong>热补丁的编辑更加高效。</strong>使用热补丁，你不需要去修改其他的无关代码，也不需要你去联合反编译DSDT然后除错，更是大大节省了你的工程量。</p>
<p><strong>热补丁更加安全。</strong>如果热补丁导致你的启动出现问题，你只需要还原对应的热补丁修改（删除热补丁）即可，既快捷又方便，并且也无需备份什么。而如果是DSDT，在改动前你必须备份原有DSDT，而且出了问题时排除代码是个很让人头疼的问题。</p>
<p><strong>热补丁管理方便。</strong>每个功能可以写一个热补丁，无论是配置文件里还是SSDT，都方便管理与添加；并且由于热补丁的动态注入特性，在部分情况下可以实现直接修改DSDT报错而不能完成的修改。</p>
<p><strong>热补丁与平台无关</strong>。由于这一点，有些修改的热补丁可以跨平台使用，大大提高了黑果的移植度以及修改工程量。尤其是，当你发现某些机型的DSDT不能通用但是却具有高度相似的修改时，热补丁的优势将尤其明显(比如潮7000 13寸与14寸，以及潮5000关于触摸板的部分)</p>
<p>基于上述这几点，我们也显然可以看到了电池热补丁的优势：<strong>跨平台、易修改、易参考、高度可移植</strong>。</p>
<h1 id="阅读预备"><a href="#阅读预备" class="headerlink" title="阅读预备"></a>阅读预备</h1><p>正如我一直跟黑果进阶的同学反复强调的那样，热补丁是DSDT的延伸，因此，基于这一点，以下情况，我不推荐您阅读此教程：</p>
<ul>
<li><p>没有良好的DSDT基础</p>
</li>
<li><p>电池尚未用DSDT补丁修改好</p>
</li>
</ul>
<p>在阅读本教程之前，建议先去阅读下这篇帖子：<a href="http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1778499&highlight=" target="_blank" rel="noopener">修改dsdt实现电量显示方法（整理修改已有帖子)</a>，了解下基础的字节以及补丁工作原理，然后再来阅读下本教程。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>电池热补丁的原理，本质就是热补丁的原理以及电池的字节拆分原理，在此我不再赘述，有兴趣的请自己去百度相关教程。不过涉及到一些这二者协调部分的原理，在这里我有必要解释一下：</p>
<p>我们知道，在DSDT的电池补丁里，电池的各种变量，存在一个变量的字节位占用问题，如果将变量字节位搞错，将会导致打补丁后的DSDT无法正常显示电池信息。而热补丁本质就是DSDT的延伸，因此，我们在热补丁中动态修补电池字节数据的时候，也必须保留对原有字节位的占用，而不能随意错位。电池的数据一般存储在一个大的OperationRegion块中。懂热补丁的都知道，显然OperationRegion方法是不允许直接注入的。因此，我们通常想到的就是直接将电池设备改名，重新注入数据。这种方法经过本人测试，存在很大问题，其中之一就是数据无法正确注入修改后的电池数据（OperationRegion）到DSDT中，会报错。另外这样书写的热补丁代码量太大，需要处理的引用与方法交叉十分多。</p>
<p>所幸宪武大神给出了一个折中的方法：新建一个OperationRegion块，在这个新块里动态注入所有的拆分字节数据；同时，对原有的未拆分字节保留空位，从而在保证位移量正确的情况下正确注入并引用新的数据。如此，电池就可以以热补丁的形式注入字节数据并被修改为正确信息。</p>
<p>当然，这种方法也有其弊端在里面：由于二次调用数据，这样的热补丁执行效率会有点低，但是对于现在的机子而言，这个效率的影响微乎其微。</p>
<p>基于这样的一个思路，我们接下来就可以开始制作电池的热补丁。</p>
<h1 id="开始制作"><a href="#开始制作" class="headerlink" title="开始制作"></a>开始制作</h1><h2 id="分析补丁"><a href="#分析补丁" class="headerlink" title="分析补丁"></a>分析补丁</h2><p>在开始制作之前，我们首先就需要对我们的电池DSDT补丁进行分析，来确定哪些数据是我们接下来需要使用到的。比如以潮7000 13寸的电池热补丁来说，是这样的：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.</span><br><span class="line"><span class="number">2</span>. </span><br><span class="line"><span class="number">3</span>. #BML0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">4</span>. #BAV0,   <span class="number">16</span>, </span><br><span class="line"><span class="number">5</span>. #BAC0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">6</span>. #BRC0,   <span class="number">16</span>, </span><br><span class="line"><span class="number">7</span>. #BTP0,   <span class="number">16</span>, </span><br><span class="line"><span class="number">8</span>. #BCC0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">9</span>. #FCC0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">10</span>.#BDC0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">11</span>.#BDV0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">12</span>.#BMD0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">13</span>.#MANA,   <span class="number">96</span>,</span><br><span class="line"><span class="number">14</span>.#DENA,   <span class="number">64</span>,</span><br><span class="line"><span class="number">15</span>.#CHEM,   <span class="number">32</span>,</span><br><span class="line"><span class="number">16</span>.#ATE0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">17</span>.#ATF0,   <span class="number">16</span>,</span><br><span class="line"><span class="number">18</span>.#FWIN,   <span class="number">64</span>,</span><br><span class="line"><span class="number">19</span>.#BARC,   <span class="number">128</span>,</span><br><span class="line"><span class="number">20</span>.#SMDA,   <span class="number">256</span>,</span><br><span class="line"><span class="number">21</span>. </span><br><span class="line"><span class="number">22</span>.#BAT0 <span class="keyword">on</span> H_EC</span><br><span class="line"><span class="number">23</span>.#BAT1 <span class="keyword">on</span> H_EC</span><br><span class="line"><span class="number">24</span>.#BAT2 <span class="keyword">on</span> H_EC</span><br><span class="line"><span class="number">25</span>. </span><br><span class="line"><span class="number">26</span>. <span class="keyword">into</span> device label H_EC code_regex BML0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> ML00,<span class="number">8</span>,ML01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">27</span>. <span class="keyword">into</span> device label H_EC code_regex BAV0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> AV00,<span class="number">8</span>,AV01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">28</span>. <span class="keyword">into</span> device label H_EC code_regex BAC0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> AC00,<span class="number">8</span>,AC01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">29</span>. <span class="keyword">into</span> device label H_EC code_regex BRC0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> RC00,<span class="number">8</span>,RC01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">30</span>. <span class="keyword">into</span> device label H_EC code_regex BTP0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> TP00,<span class="number">8</span>,TP01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">31</span>. <span class="keyword">into</span> device label H_EC code_regex BCC0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> CC00,<span class="number">8</span>,CC01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">32</span>. <span class="keyword">into</span> device label H_EC code_regex FCC0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> FC00,<span class="number">8</span>,FC01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">33</span>. <span class="keyword">into</span> device label H_EC code_regex BDC0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> DC00,<span class="number">8</span>,DC01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">34</span>. <span class="keyword">into</span> device label H_EC code_regex BDV0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> DV00,<span class="number">8</span>,DV01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">35</span>. <span class="keyword">into</span> device label H_EC code_regex BMD0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> MD00,<span class="number">8</span>,MD01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">36</span>. <span class="keyword">into</span> device label H_EC code_regex CHEM,\s+<span class="number">32</span>, replace_matched <span class="keyword">begin</span> HEM0,<span class="number">8</span>,HEM1,<span class="number">8</span>,HEM2,<span class="number">8</span>,HEM3,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">37</span>. <span class="keyword">into</span> device label H_EC code_regex ATE0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> TE00,<span class="number">8</span>,TE01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">38</span>. <span class="keyword">into</span> device label H_EC code_regex ATF0,\s+<span class="number">16</span>, replace_matched <span class="keyword">begin</span> TF00,<span class="number">8</span>,TF01,<span class="number">8</span>, <span class="keyword">end</span>;</span><br><span class="line"><span class="number">39</span>. </span><br><span class="line"><span class="number">40</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BIF</span> <span class="title">code_regex</span> \<span class="params">(BML0, replaceall_matched <span class="keyword">begin</span> (B1B2(ML00,ML01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">41</span>. </span><br><span class="line"><span class="number">42</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> \<span class="params">(BML0, replaceall_matched <span class="keyword">begin</span> (B1B2(ML00,ML01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">43</span>. </span><br><span class="line"><span class="number">44</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> <span class="title">BAV0</span>\), <span class="title">replaceall_matched</span> <span class="title">begin</span> <span class="title">B1B2</span><span class="params">(AV00,AV01)</span>), <span class="title">end</span>;</span></span><br><span class="line"><span class="number">45</span>. </span><br><span class="line"><span class="number">46</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> \<span class="params">(BAV0, replaceall_matched <span class="keyword">begin</span> (B1B2(AV00,AV01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">47</span>. </span><br><span class="line"><span class="number">48</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BAV0, replaceall_matched <span class="keyword">begin</span> (B1B2(AV00,AV01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">49</span>. </span><br><span class="line"><span class="number">50</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> \<span class="params">(BAC0\)</span>, <span class="title">replaceall_matched</span> <span class="title">begin</span> <span class="params">(B1B2(AC00,AC01)</span>), <span class="title">end</span>;</span></span><br><span class="line"><span class="number">51</span>. </span><br><span class="line"><span class="number">52</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> \<span class="params">(BAC0, replaceall_matched <span class="keyword">begin</span> (B1B2(AC00,AC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">53</span>. </span><br><span class="line"><span class="number">54</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BST</span> <span class="title">code_regex</span> \<span class="params">(BRC0, replaceall_matched <span class="keyword">begin</span> (B1B2(RC00,RC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">55</span>. </span><br><span class="line"><span class="number">56</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BRC0, replaceall_matched <span class="keyword">begin</span> (B1B2(RC00,RC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">57</span>. </span><br><span class="line"><span class="number">58</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BTP0, replaceall_matched <span class="keyword">begin</span> (B1B2(TP00,TP01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">59</span>. </span><br><span class="line"><span class="number">60</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BCC0, replaceall_matched <span class="keyword">begin</span> (B1B2(CC00,CC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">61</span>. </span><br><span class="line"><span class="number">62</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BIF</span> <span class="title">code_regex</span> \<span class="params">(FCC0, replaceall_matched <span class="keyword">begin</span> (B1B2(FC00,FC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">63</span>. </span><br><span class="line"><span class="number">64</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BIF</span> <span class="title">code_regex</span> \<span class="params">(FCC0\)</span> <span class="title">replaceall_matched</span> <span class="title">begin</span> <span class="params">(B1B2(FC00,FC01)</span>) <span class="title">end</span>;</span></span><br><span class="line"><span class="number">65</span>. </span><br><span class="line"><span class="number">66</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(FCC0, replaceall_matched <span class="keyword">begin</span> (B1B2(FC00,FC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">67</span>. </span><br><span class="line"><span class="number">68</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BIF</span> <span class="title">code_regex</span> \<span class="params">(BDC0, replaceall_matched <span class="keyword">begin</span> (B1B2(DC00,DC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">69</span>. </span><br><span class="line"><span class="number">70</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BDC0, replaceall_matched <span class="keyword">begin</span> (B1B2(DC00,DC01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">71</span>. </span><br><span class="line"><span class="number">72</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">BIF</span> <span class="title">code_regex</span> \<span class="params">(BDV0, replaceall_matched <span class="keyword">begin</span> (B1B2(DV00,DV01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">73</span>. </span><br><span class="line"><span class="number">74</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BDV0, replaceall_matched <span class="keyword">begin</span> (B1B2(DV00,DV01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">75</span>. </span><br><span class="line"><span class="number">76</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BMD0, replaceall_matched <span class="keyword">begin</span> (B1B2(MD00,MD01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">77</span>. </span><br><span class="line"><span class="number">78</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(MANA, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0x30,96)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">79</span>. </span><br><span class="line"><span class="number">80</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(DENA, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0x8C,64)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">81</span>. </span><br><span class="line"><span class="number">82</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(CHEM, replaceall_matched <span class="keyword">begin</span> (B1B4(HEM0,HEM1,HEM2,HEM3)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">83</span>. </span><br><span class="line"><span class="number">84</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(ATE0, replaceall_matched <span class="keyword">begin</span> (B1B2(TE00,TE01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">85</span>. </span><br><span class="line"><span class="number">86</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">SMTF</span> <span class="title">code_regex</span> \<span class="params">(ATF0, replaceall_matched <span class="keyword">begin</span> (B1B2(TF00,TF01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">87</span>. </span><br><span class="line"><span class="number">88</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(ATF0, replaceall_matched <span class="keyword">begin</span> (B1B2(TF00,TF01)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">89</span>. </span><br><span class="line"><span class="number">90</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(FWIN, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0xA0,64)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">91</span>. </span><br><span class="line"><span class="number">92</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">MHIF</span> <span class="title">code_regex</span> \<span class="params">(FWIN, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0xA0,64)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">93</span>. </span><br><span class="line"><span class="number">94</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">GSBI</span> <span class="title">code_regex</span> \<span class="params">(BARC, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0xA8,128)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">95</span>. </span><br><span class="line"><span class="number">96</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">MHPF</span> <span class="title">code_regex</span> <span class="title">Store</span>\<span class="title">s</span>\<span class="params">(FB4,\sSMDA\)</span> <span class="title">replaceall_matched</span> <span class="title">begin</span> \\_<span class="title">SB</span>.<span class="title">PCI0</span>.<span class="title">LPCB</span>.<span class="title">H_EC</span>.<span class="title">WECB</span><span class="params">(0x04,256,FB4)</span> <span class="title">end</span>;</span></span><br><span class="line"><span class="number">97</span>. </span><br><span class="line"><span class="number">98</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">MHPF</span> <span class="title">code_regex</span> \<span class="params">(SMDA, replaceall_matched <span class="keyword">begin</span> (\\_SB.PCI0.LPCB.H_EC.RECB(0x04,256)</span>, <span class="title">end</span>;</span></span><br><span class="line"><span class="number">99</span>. </span><br><span class="line"><span class="number">100</span>. <span class="keyword">into</span> device label BAT1 parent_label H_EC remove_entry;</span><br><span class="line"><span class="number">101</span>. <span class="keyword">into</span> device label BAT2 parent_label H_EC remove_entry;</span><br><span class="line"><span class="number">102</span>. </span><br><span class="line"><span class="number">103</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> _<span class="title">STA</span> <span class="title">parent_label</span> <span class="title">BAT0</span> <span class="title">replace_content</span> <span class="title">begin</span> <span class="title">Return</span> <span class="params">(0x1F)</span> <span class="title">end</span>;</span></span><br><span class="line"><span class="number">104</span>. </span><br><span class="line"><span class="number">105</span>. \#B1B2</span><br><span class="line"><span class="number">106</span>. \#B1B3</span><br><span class="line"><span class="number">107</span>. \#B1B4</span><br><span class="line"><span class="number">108</span>. \#RECB</span><br><span class="line"><span class="number">109</span>. \#WECB</span><br><span class="line"><span class="number">110</span>. </span><br><span class="line"><span class="number">111</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">B1B2</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">112</span>. <span class="keyword">into</span> definitionblock code_regex . insert</span><br><span class="line"><span class="number">113</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">114</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(B1B2, 2, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">115. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">116. Return(Or(Arg0, ShiftLeft(Arg1, 8)))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">117. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">118. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">119</span>. </span><br><span class="line"><span class="number">120</span>. \#<span class="keyword">For</span> <span class="number">24</span> bit registers</span><br><span class="line"><span class="number">121</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">B1B3</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">122</span>. <span class="keyword">into</span> definitionblock code_regex . insert</span><br><span class="line"><span class="number">123</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">124</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(B1B3, 3, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">125. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">126. ​    Store(Arg2, Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">127. ​    Or(Arg1, ShiftLeft(Local0, 8), Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">128. ​    Or(Arg0, ShiftLeft(Local0, 8), Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">129. ​    Return(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">130. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">131. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">132</span>. </span><br><span class="line"><span class="number">133</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">B1B4</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">134</span>. <span class="keyword">into</span> definitionblock code_regex . insert</span><br><span class="line"><span class="number">135</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">136</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(B1B4, 4, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">137. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">138. ​    Store(Arg3, Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">139. ​    Or(Arg2, ShiftLeft(Local0, 8), Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">140. ​    Or(Arg1, ShiftLeft(Local0, 8), Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">141. ​    Or(Arg0, ShiftLeft(Local0, 8), Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">142. ​    Return(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">143. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">144. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">145</span>. </span><br><span class="line"><span class="number">146</span>. \# utility methods <span class="keyword">to</span> <span class="keyword">read</span>/<span class="keyword">write</span> buffers <span class="keyword">from</span>/<span class="keyword">to</span> EC</span><br><span class="line"><span class="number">147</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RE1B</span> <span class="title">parent_label</span> <span class="title">H_EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">148</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RECB</span> <span class="title">parent_label</span> <span class="title">H_EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">149</span>. <span class="keyword">into</span> device label H_EC insert</span><br><span class="line"><span class="number">150</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">151</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(RE1B, 1, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">152. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">153. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">154. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">155. ​    <span class="title">Return</span><span class="params">(BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">156. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">157. <span class="title">Method</span> <span class="params">(RECB, 2, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">158. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">159. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">160. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">161. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">162. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">163. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">164. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">165. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">166. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">167. ​        Store(RE1B(Arg0), Index(TEMP, Local0))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">168. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">169. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">170. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">171. ​    <span class="title">Return</span><span class="params">(TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">172. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">173. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">174</span>. </span><br><span class="line"><span class="number">175</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WE1B</span> <span class="title">parent_label</span> <span class="title">H_EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">176</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WECB</span> <span class="title">parent_label</span> <span class="title">H_EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">177</span>. <span class="keyword">into</span> device label H_EC insert</span><br><span class="line"><span class="number">178</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">179</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(WE1B, 2, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">180. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">181. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">182. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">183. ​    <span class="title">Store</span><span class="params">(Arg1, BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">184. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">185. <span class="title">Method</span> <span class="params">(WECB, 3, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">186. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">187. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">188. // <span class="title">Arg2</span> - <span class="title">value</span> <span class="title">to</span> <span class="title">write</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">189. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">190. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">191. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">192. ​    <span class="title">Store</span><span class="params">(Arg2, TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">193. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">194. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">195. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">196. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">197. ​        WE1B(Arg0, DerefOf(Index(TEMP, Local0)))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">198. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">199. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">200. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">201. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">202. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">203</span>. </span><br><span class="line"><span class="number">204</span>. \# utility methods <span class="keyword">to</span> <span class="keyword">read</span>/<span class="keyword">write</span> buffers <span class="keyword">from</span>/<span class="keyword">to</span> EC</span><br><span class="line"><span class="number">205</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RE1B</span> <span class="title">parent_label</span> <span class="title">EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">206</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RECB</span> <span class="title">parent_label</span> <span class="title">EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">207</span>. <span class="keyword">into</span> device label EC insert</span><br><span class="line"><span class="number">208</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">209</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(RE1B, 1, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">210. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">211. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">212. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">213. ​    <span class="title">Return</span><span class="params">(BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">214. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">215. <span class="title">Method</span> <span class="params">(RECB, 2, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">216. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">217. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">218. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">219. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">220. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">221. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">222. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">223. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">224. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">225. ​        Store(RE1B(Arg0), Index(TEMP, Local0))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">226. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">227. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">228. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">229. ​    <span class="title">Return</span><span class="params">(TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">230. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">231. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">232</span>. </span><br><span class="line"><span class="number">233</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WE1B</span> <span class="title">parent_label</span> <span class="title">EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">234</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WECB</span> <span class="title">parent_label</span> <span class="title">EC</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">235</span>. <span class="keyword">into</span> device label EC insert</span><br><span class="line"><span class="number">236</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">237</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(WE1B, 2, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">238. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">239. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">240. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">241. ​    <span class="title">Store</span><span class="params">(Arg1, BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">242. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">243. <span class="title">Method</span> <span class="params">(WECB, 3, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">244. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">245. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">246. // <span class="title">Arg2</span> - <span class="title">value</span> <span class="title">to</span> <span class="title">write</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">247. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">248. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">249. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">250. ​    <span class="title">Store</span><span class="params">(Arg2, TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">251. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">252. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">253. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">254. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">255. ​        WE1B(Arg0, DerefOf(Index(TEMP, Local0)))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">256. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">257. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">258. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">259. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">260. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">261</span>. </span><br><span class="line"><span class="number">262</span>. \# utility methods <span class="keyword">to</span> <span class="keyword">read</span>/<span class="keyword">write</span> buffers <span class="keyword">from</span>/<span class="keyword">to</span> EC</span><br><span class="line"><span class="number">263</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RE1B</span> <span class="title">parent_label</span> <span class="title">EC0</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">264</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">RECB</span> <span class="title">parent_label</span> <span class="title">EC0</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">265</span>. <span class="keyword">into</span> device label EC0 insert</span><br><span class="line"><span class="number">266</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">267</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(RE1B, 1, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">268. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">269. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">270. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">271. ​    <span class="title">Return</span><span class="params">(BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">272. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">273. <span class="title">Method</span> <span class="params">(RECB, 2, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">274. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">275. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">276. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">277. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">278. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">279. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">280. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">281. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">282. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">283. ​        Store(RE1B(Arg0), Index(TEMP, Local0))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">284. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">285. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">286. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">287. ​    <span class="title">Return</span><span class="params">(TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">288. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">289. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">290</span>. </span><br><span class="line"><span class="number">291</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WE1B</span> <span class="title">parent_label</span> <span class="title">EC0</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">292</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">WECB</span> <span class="title">parent_label</span> <span class="title">EC0</span> <span class="title">remove_entry</span>;</span></span><br><span class="line"><span class="number">293</span>. <span class="keyword">into</span> device label EC0 insert</span><br><span class="line"><span class="number">294</span>. <span class="keyword">begin</span></span><br><span class="line"><span class="number">295</span>. <span class="function"><span class="keyword">Method</span> <span class="params">(WE1B, 2, NotSerialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">296. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">297. ​    OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">298. ​    Field(ERAM, ByteAcc, NoLock, Preserve) &#123; BYTE, 8 &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">299. ​    <span class="title">Store</span><span class="params">(Arg1, BYTE)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">300. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">301. <span class="title">Method</span> <span class="params">(WECB, 3, Serialized)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">302. // <span class="title">Arg0</span> - <span class="title">offset</span> <span class="title">in</span> <span class="title">bytes</span> <span class="title">from</span> <span class="title">zero</span>-<span class="title">based</span> <span class="title">EC</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">303. // <span class="title">Arg1</span> - <span class="title">size</span> <span class="title">of</span> <span class="title">buffer</span> <span class="title">in</span> <span class="title">bits</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">304. // <span class="title">Arg2</span> - <span class="title">value</span> <span class="title">to</span> <span class="title">write</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">305. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">306. ​    ShiftRight(Arg1, 3, Arg1)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">307. ​    Name(TEMP, Buffer(Arg1) &#123; &#125;</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">308. ​    <span class="title">Store</span><span class="params">(Arg2, TEMP)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">309. ​    <span class="title">Add</span><span class="params">(Arg0, Arg1, Arg1)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">310. ​    <span class="title">Store</span><span class="params">(0, Local0)</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">311. ​    <span class="title">While</span> <span class="params">(LLess(Arg0, Arg1)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">312. ​    <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">313. ​        WE1B(Arg0, DerefOf(Index(TEMP, Local0)))\n</span></span></span><br><span class="line"><span class="function"><span class="comment">314. ​        Increment(Arg0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">315. ​        Increment(Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">316. ​    &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">317. &#125;\<span class="title">n</span></span></span><br><span class="line"><span class="function">318. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">319</span>. </span><br><span class="line"><span class="number">320</span>.#Fix Battery <span class="number">0</span>% Status</span><br><span class="line"><span class="number">321</span>.#Maintained <span class="keyword">by</span>: RehabMan <span class="keyword">for</span>: Laptop Patches</span><br><span class="line"><span class="number">322</span>.#system_Mutex.txt</span><br><span class="line"><span class="number">323</span>. </span><br><span class="line"><span class="number">324</span>.#</span><br><span class="line"><span class="number">325</span>.# Some DSDTs use Mutex objects <span class="keyword">with</span> non-zero a SyncLevel.  Evidently,</span><br><span class="line"><span class="number">326</span>.# OS X <span class="keyword">has</span> some difficulty <span class="keyword">with</span> this part <span class="keyword">of</span> the ACPI spec, either that </span><br><span class="line"><span class="number">327</span>.# <span class="keyword">or</span> the DSDTs are, <span class="keyword">in</span> fact, codec incorrectly <span class="keyword">and</span> Windows <span class="keyword">is</span> ignoring </span><br><span class="line"><span class="number">328</span>.# it.</span><br><span class="line"><span class="number">329</span>. </span><br><span class="line"><span class="number">330</span>.# The common <span class="keyword">result</span> <span class="keyword">of</span> a non-zero SyncLevel <span class="keyword">is</span> failure <span class="keyword">of</span> methods at the</span><br><span class="line"><span class="number">331</span>.# point <span class="keyword">of</span> Acquire <span class="keyword">on</span> the mutext <span class="keyword">in</span> question.  This can <span class="keyword">result</span> <span class="keyword">in</span> strange</span><br><span class="line"><span class="number">332</span>.# behavior, failed battery status, <span class="keyword">or</span> other issues.</span><br><span class="line"><span class="number">333</span>.#</span><br><span class="line"><span class="number">334</span>. # This patch corrects all Mutex objects declared <span class="keyword">with</span> a non-zero</span><br><span class="line"><span class="number">335</span>. # SyncLevel <span class="keyword">to</span> use zero.</span><br><span class="line"><span class="number">336</span>. #</span><br><span class="line"><span class="number">337</span>. </span><br><span class="line"><span class="number">338</span>. # <span class="number">2</span>x <span class="keyword">as</span> there <span class="keyword">is</span> some sort <span class="keyword">of</span> MaciASL bug...</span><br><span class="line"><span class="number">339</span>. # (code_regex_not seems broken)</span><br><span class="line"><span class="number">340</span>. #into_all all code_regex_not Mutex\s+\([^,]*,\s+<span class="number">0</span>x00\) code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">341</span>. #into_all all code_regex_not Mutex\s+\([^,]*,\s+<span class="number">0</span>x00\) code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">342</span>. </span><br><span class="line"><span class="number">343</span>. # <span class="number">10</span>x <span class="keyword">as</span> workaround <span class="keyword">for</span> MaciASL bug...</span><br><span class="line"><span class="number">344</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">345</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">346</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">347</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">348</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">349</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">350</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">351</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">352</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">353</span>. into_all all code_regex Mutex\s+\(([^,]*),\s+[^)]*\) replaceall_matched <span class="keyword">begin</span> Mutex(%<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">end</span>;</span><br><span class="line"><span class="number">354</span>. </span><br><span class="line"><span class="number">355</span>. #Logic bug <span class="keyword">with</span> charging/discharging status (AC adapter detection)</span><br><span class="line"><span class="number">356</span>. #Some DSDTs suffer <span class="keyword">from</span> a logic bug <span class="keyword">where</span> at the point <span class="keyword">of</span> <span class="number">100</span>% capacity (fully charged battery), an incorrect #status <span class="keyword">is</span> returned <span class="keyword">from</span> _BST. This mostly affects certain ASUS laptops, but also a few others.</span><br><span class="line"><span class="number">357</span>. #Here <span class="keyword">is</span> a patch <span class="keyword">to</span> correct this problem:</span><br><span class="line"><span class="number">358</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">FBST</span> <span class="title">code_regex</span> <span class="title">If</span>\<span class="title">s</span>\<span class="params">(CHGS\s\(Zero\)</span>\)[\<span class="title">s</span>]+\<span class="comment">&#123;[\s]+Store\s\(0x02,\sLocal0\)[\s]+\&#125;</span>[\<span class="title">s</span>]+<span class="title">Else</span>[\<span class="title">s</span>]+\<span class="comment">&#123;[\s]+Store\s\(One,\sLocal0\)[\s]+\&#125;</span> <span class="title">replaceall_matched</span> <span class="title">begin</span></span></span><br><span class="line"><span class="function">359. <span class="title">If</span> <span class="params">(CHGS (Zero)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">360. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">361. ​     Store (0x02, Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">362. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">363. <span class="title">Else</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">364. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">365. ​     Store (Zero, Local0)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">366. &#125;</span></span></span><br><span class="line"><span class="function">367. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">368</span>. </span><br><span class="line"><span class="number">369</span>. #Fix HP OMEN Laptop Baterry <span class="keyword">to</span> enabled percentage <span class="keyword">and</span> discharge time</span><br><span class="line"><span class="number">370</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">SMWR</span> <span class="title">code_regex</span> <span class="title">If</span>\<span class="title">s</span>\<span class="params">(LNot\s\(ECOK\)</span>\)\<span class="title">s</span>+\<span class="comment">&#123;\s+Return\s\(0xFF\)\s+\&#125;</span> <span class="title">replaceall_matched</span> <span class="title">begin</span></span></span><br><span class="line"><span class="function">371. <span class="title">If</span> <span class="params">(LEqual (ECOK, One)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">372. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">373. ​     Return (0xFF)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">374. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">375. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">376</span>. </span><br><span class="line"><span class="number">377</span>. #Fix Hasee YOUYA Laptop Baterry <span class="keyword">to</span> enabled percentage <span class="keyword">and</span> discharge time</span><br><span class="line"><span class="number">378</span>. <span class="keyword">into</span> <span class="function"><span class="keyword">method</span> <span class="title">label</span> <span class="title">SMWR</span> <span class="title">code_regex</span> <span class="title">If</span>\<span class="title">s</span>\<span class="params">(LNot\s\(ECON\)</span>\)\<span class="title">s</span>+\<span class="comment">&#123;\s+Return\s\(0xFF\)\s+\&#125;</span> <span class="title">replaceall_matched</span> <span class="title">begin</span></span></span><br><span class="line"><span class="function">379. <span class="title">If</span> <span class="params">(LEqual (ECON, One)</span>)\<span class="title">n</span></span></span><br><span class="line"><span class="function">380. <span class="comment">&#123;\n</span></span></span><br><span class="line"><span class="function"><span class="comment">381. ​     Return (0xFF)\n</span></span></span><br><span class="line"><span class="function"><span class="comment">382. &#125;</span>\<span class="title">n</span></span></span><br><span class="line"><span class="function">383. <span class="title">end</span>;</span></span><br><span class="line"><span class="number">384</span>. </span><br><span class="line"><span class="number">385</span>. #<span class="keyword">into</span> definitionblock code_regex . insert</span><br><span class="line"><span class="number">386</span>. #<span class="keyword">begin</span></span><br><span class="line"><span class="number">387</span>. #<span class="keyword">External</span> (_SB.PCI0.BATC, DeviceObj)</span><br><span class="line"><span class="number">388</span>. #<span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>看起来这个补丁代码确实很复杂，但是仔细分析下，我们修改这个热补丁，无非需要以下这些数据：</p>
<ul>
<li><strong>电池的设备位置</strong></li>
<li><strong>额外添加的方法</strong></li>
<li><strong>拆分的字节数据</strong></li>
<li><strong>引用修改字节的方法(Method)</strong></li>
</ul>
<p>通过对于IOReg等的分析，我们得知电池设备为H_EC.BAT0；而对此字节补丁进行分析，我们发现，它实际上修改了这些字节数据：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BML0 </span>→ <span class="keyword">B1B2 </span>(ML00, ML01)</span><br><span class="line"><span class="keyword">BAV0 </span>→ <span class="keyword">B1B2 </span>(AV00, AV01)</span><br><span class="line"><span class="keyword">BAC0 </span>→ <span class="keyword">B1B2 </span>(AC00, AC01)</span><br><span class="line"><span class="keyword">BRC0 </span>→ <span class="keyword">B1B2 </span>(RC00 ,RC01)</span><br><span class="line"><span class="keyword">BTP0 </span>→ <span class="keyword">B1B2 </span>(TP00, TP01)</span><br><span class="line"><span class="keyword">BCC0 </span>→ <span class="keyword">B1B2 </span>(CC00, CC01)</span><br><span class="line"><span class="symbol">FCC0</span> → <span class="keyword">B1B2 </span>(FC00, FC01)</span><br><span class="line"><span class="keyword">BDC0 </span>→ <span class="keyword">B1B2 </span>(DC00, DC01)</span><br><span class="line"><span class="keyword">BDV0 </span>→ <span class="keyword">B1B2 </span>(DV00, DV01)</span><br><span class="line"><span class="keyword">BMD0 </span>→ <span class="keyword">B1B2 </span>(MD00, MD01)</span><br><span class="line"><span class="symbol">MANA</span> → RECB (<span class="number">0x30</span>, <span class="number">0x60</span>)</span><br><span class="line"><span class="symbol">DENA</span> → RECB (<span class="number">0x8C</span>, <span class="number">0x40</span>)</span><br><span class="line"><span class="symbol">CHEM</span> → <span class="keyword">B1B4 </span>(HEM0, HEM1, HEM2, HEM3)</span><br><span class="line"><span class="symbol">ATE0</span> → <span class="keyword">B1B2 </span>(TE00, TE01)</span><br></pre></td></tr></table></figure>

<p>这些字节数据全部位于H_EC下的ECF2这个OperationRegion中。随后，对这些拆分的字节添加的语句进行分析，我们也找到了我们需要添加的额外方法：<strong>RECB、RE1B、B1B2、B1B4</strong></p>
<p>接下来 ，我们前去阅读潮7000 13修改好电池后的DSDT（样本点击这里下载），通过反复查找对比我们前面找到的额外方法，我们可以发现，这些方法在以下这些DSDT方法中出现（也即<strong>引用修改字节的方法</strong>）：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_SB<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.VPC0</span>下：</span><br><span class="line"></span><br><span class="line">MHIF、SMTF、GSBI</span><br><span class="line"></span><br><span class="line">_SB<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.BAT0</span>下：</span><br><span class="line"></span><br><span class="line">_BIF、_BST</span><br></pre></td></tr></table></figure>

<p>由此，我们确定了我们需要修改的所有地方，接下来我们就需要把这些修改注入到我们的热补丁中。</p>
<h2 id="数据插入"><a href="#数据插入" class="headerlink" title="数据插入"></a>数据插入</h2><p>接下来，我们就需要进行插入操作了。打开Maciasl软件(相关下载可在我博客的资源页面获取)，新建一个文件，插入以下这段代码，使其声明为一个热补丁文件；然后保存为DSL文本文件(文件名随意起，只要保证以”SSDT-“开头就好了)：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (<span class="string">""</span>, <span class="string">"SSDT"</span>, <span class="number">2</span>, <span class="string">"hack"</span>, <span class="string">"xxxx"</span>, <span class="number">0x00000000</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的XXXX为你前面找到的电池设备名称，比如我的是BAT0，那这里就写为BAT0。</p>
<p>然后，复制DSDT中的电池字节OperationRegion到这个热补丁中，就像这样：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E5%A4%8D%E5%88%B6ecf2.png" alt="复制ecf2"></p>
<p>然后，我们将<strong>额外添加的方法</strong>与<strong>引用修改字节的方法(Method)</strong>同时插入到这个DSDT里面：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E6%8F%92%E5%85%A5%E6%96%B9%E6%B3%95.png" alt="插入方法"></p>
<p><strong>注意：在插入的时候，在同一个设备下面的方法一定要放到一块！</strong>比如<code>_BIF</code>与<code>_BST</code>同为<code>BAT0</code>设备下面的方法，在插入时就要放到一块。这样做的目的，是为了后面修改时方便修改，减少代码的书写以及使代码层次分明。</p>
<h2 id="添加位置代码"><a href="#添加位置代码" class="headerlink" title="添加位置代码"></a>添加位置代码</h2><p>到这里，我们并未完全完成代码的插入。我们需要BIOS知道我们插入的这些方法都是动态注入修补到哪些位置的方法，这需要我们添加位置代码。</p>
<p>比如，比如<code>_BIF</code>与<code>_BST</code>同为<code>BAT0</code>设备下面的方法，而<code>BAT0</code>位于<code>_SB.PCI0.LPCB.H_EC</code></p>
<p>。因此，我们需要在  <code>Method (_BIF, 0, NotSerialized)</code>前插入<code>Scope</code>位置代码，在<code>_BST</code>方法结束位置插入结束代码”}”。它看起来的效果应该像这样：</p>
<pre><code>Scope (_SB.PCI0.LPCB.H_EC.BAT0)
{   
     Method (_BIF, 0, NotSerialized) 
     {
             ...
     }

     Method (_BST, 0, NotSerialized) 
     {
             ...
     }
}</code></pre><p>同样地，对于<code>ECF2</code>这个OperationRegion，它的位置在<code>_SB.PCI0.LPCB.H_EC</code>，因此，应该像这样在<code>ECF2</code>下插入位置代码：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Scope (_SB<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span>)</span><br><span class="line">&#123;        </span><br><span class="line">	 OperationRegion (ECF2, EmbeddedControl, Zero, <span class="number">0</span>xFF)</span><br><span class="line">            Field (ECF2, ByteAcc, Lock, Preserve)</span><br><span class="line">            &#123;</span><br><span class="line">            			...</span><br><span class="line">            &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>而对于RECB、RE1B、B1B2、B1B4这三个方法，由于其本身就在根设备下，因此不需要再额外添加位置代码，保留原有层级结构即可。</p>
<p>对所有我们刚才插入进来的代码进行位置代码插入，最终修改后，我们可以在左侧的窗格看到类似的层级结构：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E5%B1%82%E7%BA%A7.png" alt="层级"></p>
<p>在图里我们看到，所有方法，除了OperationRegion外，在层层展开下均能看见，并且位置正确，层级结构不错位；同时进行一下编译，也看不到任何与”}”有关的错误：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E6%97%A0%E5%B1%82%E7%BA%A7%E9%94%99%E8%AF%AF.png" alt="无层级错误"></p>
<h2 id="添加外部引用"><a href="#添加外部引用" class="headerlink" title="添加外部引用"></a>添加外部引用</h2><p>如果以上步骤皆操作正确，那么接下来你所看到的错误，将全部与添加外部引用有关，就像上图你看到的那样。这一部分的步骤主要就是添加外部引用。</p>
<p>首先注意下，我们的位置代码那里，有三个设备被引用，分别是<code>_SB.PCI0.LPCB.H_EC</code>、<code>_SB.PCI0.LPCB.H_EC.BAT0</code>和<code>_SB.PCI0.LPCB.H_EC.VPC0</code>。由于它们以Scope形式引用，必须要有设备声明，因此，我们需要添加这三个设备的外部引用到第2行下面，就像这样：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (<span class="string">""</span>, <span class="string">"SSDT"</span>, <span class="number">2</span>, <span class="string">"hack"</span>, <span class="string">"BAT0"</span>, <span class="number">0</span>x00000000)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span>, DeviceObj)</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.BAT0</span>, DeviceObj)</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.VPC0</span>, DeviceObj)</span><br><span class="line"></span><br><span class="line">    Scope (_SB<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span>)</span><br><span class="line">		&#123; </span><br><span class="line">					...</span><br></pre></td></tr></table></figure>

<p>其中<code>DeviceObj</code>表示这是一个ACPI设备。</p>
<p>编辑好后，我们再次编译，可以看到相关的报错全都消失了：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E7%BC%96%E8%AF%911.png" alt="编译1"></p>
<p>接下来，我们根据报错，继续在DSDT里搜索其他的报错代码，并添加相关引用。</p>
<p>比如对于<code>BASC</code>，我们在DSDT搜索：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/basc.png" alt="basc"></p>
<p>可以看到，这是<code>BAT0</code>下的一个<code>Name</code>变量，对应<code>IntObj</code>，添加外部引用如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (<span class="string">""</span>, <span class="string">"SSDT"</span>, <span class="number">2</span>, <span class="string">"hack"</span>, <span class="string">"BAT0"</span>, <span class="number">0</span>x00000000)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span>, DeviceObj)</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.BAT0</span>, DeviceObj)</span><br><span class="line">    External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.VPC0</span>, DeviceObj)</span><br><span class="line">		External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.BAT0</span><span class="selector-class">.BASC</span>, IntObj) <span class="comment">//这是插入的代码</span></span><br><span class="line">		</span><br><span class="line">    Scope (_SB<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span>)</span><br><span class="line">		&#123; </span><br><span class="line">					...</span><br></pre></td></tr></table></figure>

<p>再次编译一下，会发现所有与<code>BASC</code>相关的报错全部消失：</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E7%BC%96%E8%AF%912.png" alt="编译2"></p>
<p>又比如，<code>_SB.PCI0.LPCB.H_EC</code>下的<code>ECMT</code>是<code>Mutex</code>变量，则对应<code>MutexObj</code>，添加：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.ECMT</span>, MutexObj)</span><br></pre></td></tr></table></figure>

<p><code>B1ST</code>则是：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.B1ST</span>, FieldUnitObj)</span><br></pre></td></tr></table></figure>

<p><code>MAMW</code>则是：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_<span class="selector-class">.PCI0</span><span class="selector-class">.LPCB</span><span class="selector-class">.H_EC</span><span class="selector-class">.MAMW</span>, MethodObj)</span><br></pre></td></tr></table></figure>

<p>……</p>
<p>通过这一系列外部引用添加，当你最后编译发现不再报错时，外部引用的添加就算结束。</p>
<p><img src="/2019/05/02/Battery Hotpatch Make/%E6%97%A0%E9%94%99.png" alt="无错"></p>
<h2 id="重命名-清空字节"><a href="#重命名-清空字节" class="headerlink" title="重命名/清空字节"></a>重命名/清空字节</h2><p>在上面的步骤完成之后，我们实际已经得到了一个基本成型的热补丁，但是这个热补丁到这还尚未修改完成，我们仍然需要两步来完成这个热补丁的修改。</p>
<p>首先，我们要把<code>ECF2</code>这个字节存放区域更名为一个与原来不一样的名字，比如<code>ECFX</code>。利用查找替换功能，我们可以很轻松完成这个步骤。</p>
<p>接下来，我们需要把所有不拆分的字节数据段名字去掉，只保留空位。以我的为例，它就像这样：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">Scope (_SB.PCI0.LPCB.H_EC)</span><br><span class="line">&#123; </span><br><span class="line">        OperationRegion (ECFX, EmbeddedControl, Zero, <span class="number">0xFF</span>)</span><br><span class="line">        Field (ECFX, ByteAcc, Lock, Preserve)</span><br><span class="line">        &#123;</span><br><span class="line">            Offset (<span class="number">0x0E</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">16</span>,</span><br><span class="line">            ML00,   <span class="number">8</span>, </span><br><span class="line">            ML01,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">16</span>,</span><br><span class="line">            AV00,   <span class="number">8</span>, </span><br><span class="line">            AV01,   <span class="number">8</span>, </span><br><span class="line">            AC00,   <span class="number">8</span>, </span><br><span class="line">            AC01,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x1C</span>), </span><br><span class="line">            RC00,   <span class="number">8</span>, </span><br><span class="line">            RC01,   <span class="number">8</span>, </span><br><span class="line">            TP00,   <span class="number">8</span>, </span><br><span class="line">            TP01,   <span class="number">8</span>, </span><br><span class="line">            CC00,   <span class="number">8</span>, </span><br><span class="line">            CC01,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            ,   <span class="number">16</span>,</span><br><span class="line">            FC00,   <span class="number">8</span>, </span><br><span class="line">            FC01,   <span class="number">8</span>, </span><br><span class="line">            DC00,   <span class="number">8</span>, </span><br><span class="line">            DC01,   <span class="number">8</span>, </span><br><span class="line">            DV00,   <span class="number">8</span>, </span><br><span class="line">            DV01,   <span class="number">8</span>, </span><br><span class="line">            MD00,   <span class="number">8</span>, </span><br><span class="line">            MD01,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            ,   <span class="number">96</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x42</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x4A</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x4D</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x50</span>), </span><br><span class="line">            ,   <span class="number">8</span>,  </span><br><span class="line">            Offset (<span class="number">0x52</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            Offset (<span class="number">0x64</span>), </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            Offset (<span class="number">0x65</span>), </span><br><span class="line">            ,   <span class="number">4</span>, </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            ,   <span class="number">1</span>, </span><br><span class="line">            ,   <span class="number">8</span>,             </span><br><span class="line">            Offset (<span class="number">0x8B</span>), </span><br><span class="line">            ,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">64</span>, </span><br><span class="line">            HEM0,   <span class="number">8</span>, </span><br><span class="line">            HEM1,   <span class="number">8</span>, </span><br><span class="line">            HEM2,   <span class="number">8</span>, </span><br><span class="line">            HEM3,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            ,   <span class="number">16</span>, </span><br><span class="line">            TE00,   <span class="number">8</span>, </span><br><span class="line">            TE01,   <span class="number">8</span>, </span><br><span class="line">            TF00,   <span class="number">8</span>, </span><br><span class="line">            TF01,   <span class="number">8</span>, </span><br><span class="line">            ,   <span class="number">64</span>, </span><br><span class="line">            ,   <span class="number">128</span>, </span><br><span class="line">            Offset (<span class="number">0xC6</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里面的修改有几个要点：</p>
<ul>
<li><strong>只清空不拆分的字节</strong></li>
</ul>
<p>  对于<strong>未拆分的字节数据</strong>，就需要清空变量名，后面的数据保持不动。</p>
<p>  比如：</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ACST,</span>   <span class="number">1</span>,</span><br></pre></td></tr></table></figure>

<p>​        这一行，清空变量名，就是：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">,   <span class="number">1</span>,</span><br></pre></td></tr></table></figure>

<p>​        而那些<strong>拆分的字节数据</strong>，则不要去动，跳过去。</p>
<ul>
<li><strong>删除无拆分的offset块</strong></li>
</ul>
<p>  如果两个<code>offset</code>块之间，没有任何<strong>拆分的字节数据</strong>，则这个块可以删除。比如对于我的而言：</p>
  <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...	</span><br><span class="line">TE00,   <span class="number">8</span>, </span><br><span class="line">        TE01,   <span class="number">8</span>, </span><br><span class="line">        TF00,   <span class="number">8</span>, </span><br><span class="line">        TF01,   <span class="number">8</span>, </span><br><span class="line">        ,   		<span class="number">64</span>, </span><br><span class="line">        ,   		<span class="number">128</span>, </span><br><span class="line">        Offset (<span class="number">0xC6</span>), </span><br><span class="line">        ,   		<span class="number">8</span>, </span><br><span class="line">        ...</span><br><span class="line">        Offset (<span class="number">0xF1</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>  从<code>Offset (0xC6),</code>到<code>Offset (0xF1)</code>中间，再也没有任何<strong>拆分的字节数据</strong>，因此，我们可以抛弃这块的变量，只保留<code>Offset (0xC6)</code>，修改为：</p>
<pre><code>                  ...    
                  TE00,   8, 
      TE01,   8, 
      TF00,   8, 
      TF01,   8, 
      ,           64, 
      ,           128, 
      Offset (0xC6)  //此行之后的字节数据删除，并将末尾逗号去掉，表示到此结束
}</code></pre><p>这一块修改完成后，进行编译。如无报错，则将文件保存编译为aml文件。至此，我们的电池热补丁制作完成。</p>
<h1 id="添加改名补丁"><a href="#添加改名补丁" class="headerlink" title="添加改名补丁"></a>添加改名补丁</h1><p>接下来的过程，就与其他热补丁的改名过程无异了，我们需要生成并在Clover配置文件中添加<strong>引用修改字节的方法</strong>(需要注入Tgtbridge)。关于如何生成并添加这一补丁，我在我的触摸板教程第二版中有详细描述，不明白的可以点击<a href="http://bbs.pcbeta.com/viewthread-1797378-1-1.html" target="_blank" rel="noopener">这里</a>查看参考。对于潮7000 13寸来说，需要添加的是这些改名补丁：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Name:</span> change MHIF to XHIF <span class="keyword">in</span> VPC0</span><br><span class="line"><span class="symbol">Find:</span> <span class="number">4</span>D484946</span><br><span class="line"><span class="symbol">Replace:</span> <span class="number">58484946</span></span><br><span class="line"><span class="symbol">TgtBridge:</span> <span class="number">56504330</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Name:</span> change SMTF to XMTF <span class="keyword">in</span> VPC0</span><br><span class="line"><span class="symbol">Find:</span> <span class="number">534</span>D5446</span><br><span class="line"><span class="symbol">Replace:</span> <span class="number">584</span>D5446</span><br><span class="line"><span class="symbol">TgtBridge:</span> <span class="number">56504330</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Name:</span> change GSBI to XSBI  <span class="keyword">in</span> BAT0</span><br><span class="line"><span class="symbol">Find:</span> <span class="number">47534249</span></span><br><span class="line"><span class="symbol">Replace:</span> <span class="number">58534249</span></span><br><span class="line"><span class="symbol">TgtBridge:</span> <span class="number">42415430</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Name:</span> change _BIF to XBIF <span class="keyword">in</span> BAT0</span><br><span class="line"><span class="symbol">Find:</span> <span class="number">5</span>F424946</span><br><span class="line"><span class="symbol">Replace:</span> <span class="number">58424946</span></span><br><span class="line"><span class="symbol">TgtBridge:</span> <span class="number">42415430</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Name:</span> change _<span class="keyword">BST</span> to XBST <span class="keyword">in</span> BAT0</span><br><span class="line"><span class="symbol">Find:</span> <span class="number">5</span>F425354</span><br><span class="line"><span class="symbol">Replace:</span> <span class="number">58425354</span></span><br><span class="line"><span class="symbol">TgtBridge:</span> <span class="number">42415430</span></span><br></pre></td></tr></table></figure>

<p>接下来，保存修改后的配置文件，将新配置文件与热补丁放入对应位置，删除DSDT，重启测试。如果修改没有问题，那么电池应该会如在DSDT下一般正常工作了。祝你好运！</p>
<p>本教程所涉及的配置文件、热补丁与电池DSDT打包可以点击<a href="https://pan.baidu.com/s/1DppbiF2OEmAxbo9lnZXajA" target="_blank" rel="noopener">这里</a>下载。</p>

  </section>

 
  <div class="passage-end-tag">
        <div style="text-align:center;color: #0A4664;font-size:18px;">-------------本文已结束，<i class="fa fa-paw"></i>感谢您的阅读！！！-------------</div>
</div>


  
<section class="post-donate">

  <!-- css -->
  <style type="text/css">
    .center {
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("/images/btn_reward.gif") no-repeat;
      _background: url("/images/btn_reward.gif") no-repeat;
      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }
    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->
  <!-- Donate Module -->
  <div id="donate_module">
  <!-- btn_donate & tips -->
    <div id="donate_board" class="donate_bar center">
      
      <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
      <span class="donate_txt">
        更新文章不容易，打赏是最大鼓励！
      </span> 
    </div>
    <!-- /btn_donate & tips -->
    <!-- donate guide -->
    
    <div id="donate_guide" class="donate_bar center hidden">
      <a href="/images/wechat.jpg" title="用微信扫一扫" class="fancybox" rel="article0">
        <img src="/images/wechat.jpg" title="微信打赏" height="190px" width="auto">
      </a>
        
      &nbsp;&nbsp;
      <a href="/images/alipay.jpg" title="用支付宝扫一扫" class="fancybox" rel="article0">
        <img src="/images/alipay.jpg" title="支付宝打赏" height="190px" width="auto">
      </a>
      <span class="donate_txt">
        更新文章不容易，打赏是最大鼓励！
      </span>
    </div>
    <!-- /donate guide -->
    <!-- donate script -->
    <script type="text/javascript">
      document.getElementById('btn_donate').onclick = function() {
        $('#donate_board').addClass('hidden');
        $('#donate_guide').removeClass('hidden');
      }
      function donate_on_web(){
        $('#donate').submit();
      }
      var original_window_onload = window.onload;
      window.onload = function () {
        if (original_window_onload) {
          original_window_onload();
        }
        document.getElementById('donate_board_wdg').className = 'hidden';
      }
    </script>
    <!-- /donate script -->
  </div>
  <!-- /Donate Module -->

</section>


  
  <section class="post-comments">
    <div id="vcomments"></div>   
    <script src="/js/av-min.js"></script>    
    <script src="/js/Valine.min.js"></script>    
    <script>        
        new Valine({
            el: '#vcomments',
            appId: 'nNNIvX6ymufNrHBHNb7D3hU8-gzGzoHsz',
            appKey: 'uKc4MqLKOEiLUcKat1Yafu0j',	    
            placeholder: ' 不登录也来留下属于你的足迹吧~ ', 
            visitor: 'true'  
        })
    </script>
</section>
  


</article>
            <footer class="footer">

    <span class="footer__copyright">&copy; 2018. | 澎湖冰洲 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    
    <script src="/js/jquery.min.js"></script>
    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    

    <script src="/js/jquery.githubRepoWidget.min.js"></script>


    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

    <!-- 背景的nest动画相关片段 -->
    
    <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true},"log":false,"tagMode":false});</script></body>
</html>
